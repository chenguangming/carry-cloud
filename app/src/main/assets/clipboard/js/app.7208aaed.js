(function(){"use strict";var e={1472:function(e,t,n){var s=n(9242),o=n(3396),r=n(7139);const i={id:"app"},c={class:"messages dis-flex",id:"im-record"},l={class:"text"},u={class:"chatfield p-2"},a=["innerHTML"],d={class:"footer im-input dis-flex"};function f(e,t,n,f,g,p){return(0,o.wg)(),(0,o.iD)("div",i,[(0,o._)("div",c,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(p.currentMessage,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:(0,r.C_)(["d-flex gap-2 w-75 mb-4 bubble",{self:1===e.type}])},[(0,o._)("div",l,[(0,o._)("div",u,[(0,o._)("span",{innerHTML:p.convertToLink(e.msg)},null,8,a)])])],2)))),128))]),(0,o._)("div",d,[(0,o.wy)((0,o._)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>g.msg=e),placeholder:"请输入内容"},null,512),[[s.nr,g.msg]]),(0,o._)("button",{onClick:t[1]||(t[1]=(...e)=>p.send&&p.send(...e))},"发送")])])}n(7658);var g={name:"App",data(){return{title:"",switchType:1,uid:"",nickname:"",socket:"",msg:"",messageList:[]}},mounted(){let e=this;e.uid="CarryCloud",e.nickname="PC",e.conWebSocket(),document.onkeydown=function(t){var n=t||window.event;n&&13==n.keyCode&&e.send()},window.onbeforeunload=function(t){e.socket.send(JSON.stringify({uid:e.uid,type:1}))}},computed:{currentMessage(){let e=this,t=e.messageList.filter((e=>{if(0!==e.type)return e.msg}));return t.map((e=>(e.status=0,e))),t},usersUnRead(){return this.messageList.some((e=>e.bridge.length&&1===e.status))},currentUserList(){let e=this;return e.users.map((e=>(e.unread=this.messageList.filter((t=>t.bridge.length&&t.uid===e.uid&&1===t.status)).length,e))),e.users}},methods:{scrollBottom(){const e=document.getElementsByClassName("messages")[0];e&&(e.scrollTop=e.scrollHeight)},send(){this.msg=this.msg.trim(),this.msg&&(this.sendMessage(1,this.msg),this.scrollBottom())},sendMessage(e,t){if(this.socket.readyState==WebSocket.OPEN){let n={id:(new Date).getMilliseconds(),type:e,msg:t};this.messageList.push(n),this.socket.send(JSON.stringify(n)),this.msg=""}else{let e={type:1,msg:"请刷新页面后再试"};this.messageList.push(e)}},convertToLink:function(e){const t=/(?:(?:https?|ftp|file):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#/%=~_|$?!:,.]*\)|[A-Z0-9+&@#/%=~_|$])/gim;return e.replace(t,(e=>`<a class="text-primary" rel="noreferrer" target="_blank" href="${e}">${e}</a>`))},conWebSocket(){let e=this;if(window.WebSocket){let t=document.getElementById("app"),n="ws://127.0.0.1:8081";if(void 0!=t&&null!=t){let e=t.getAttribute("server_url");void 0!=e&&null!=e&&""!=e&&(n=e)}e.socket=new WebSocket(n);let s=e.socket;s.onopen=function(t){console.log("连接服务器成功"),e.sendMessage(0,"Peer Online")},s.onclose=function(e){console.log("服务器关闭")},s.onerror=function(){console.log("连接出错"),e.sendMessage(1,"连接"+n+"出错, 请刷新页面后再试")},s.onmessage=function(t){let n=JSON.parse(t.data);console.log("onmessage type:"+n.type+", msg:"+n.msg),e.messageList.push(n),e.$nextTick((function(){var e=document.getElementById("im-record");e.scrollTop=e.scrollHeight}))}}}}},p=n(89);const m=(0,p.Z)(g,[["render",f],["__scopeId","data-v-34f7d4fe"]]);var h=m;(0,s.ri)(h).mount("#app")}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,n),r.exports}n.m=e,function(){var e=[];n.O=function(t,s,o,r){if(!s){var i=1/0;for(a=0;a<e.length;a++){s=e[a][0],o=e[a][1],r=e[a][2];for(var c=!0,l=0;l<s.length;l++)(!1&r||i>=r)&&Object.keys(n.O).every((function(e){return n.O[e](s[l])}))?s.splice(l--,1):(c=!1,r<i&&(i=r));if(c){e.splice(a--,1);var u=o();void 0!==u&&(t=u)}}return t}r=r||0;for(var a=e.length;a>0&&e[a-1][2]>r;a--)e[a]=e[a-1];e[a]=[s,o,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,r,i=s[0],c=s[1],l=s[2],u=0;if(i.some((function(t){return 0!==e[t]}))){for(o in c)n.o(c,o)&&(n.m[o]=c[o]);if(l)var a=l(n)}for(t&&t(s);u<i.length;u++)r=i[u],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(a)},s=self["webpackChunkclipboard"]=self["webpackChunkclipboard"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=n.O(void 0,[998],(function(){return n(1472)}));s=n.O(s)})();
//# sourceMappingURL=app.7208aaed.js.map